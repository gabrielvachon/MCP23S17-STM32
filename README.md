# MCP23S17-STM32

A basic library for __MCP23S17 IO expander__ from Microchip Tecnology for STM32. Made for reading/writing registers. Using the `stm32l4xx_hal.h` HAL library.

Working with `IOCON.BANK = 0`.

## Functions

### MCP23S17_Init :
- Description :
  Initiate the struct with the desired parameters.
- Params :
  - `MCP23S17* mcp23s17` : Struct address pointer;
  - `uint8_t hardware_addr` : Hardware address of three bits (A2, A1, A0);
  - `uint16_t CS` : Chip Select pin on the microcontroller;
  - `GPIO_TypeDef* peripheral` : GPIO group (ex: GPIOA, GPIOB, GPIOC, etc.);
  - `SPI_HandleTypeDef spi_handler` : HAL SPI handler.
- Return :
  - `void`

### MCP23S17_read_REG :
- Description :
  Allows to read a register from the MCP23S17.
- Params :
  - `MCP23S17* mcp23s17` : Struct address pointer;
  - `uint8_t reg_addr` : Destination register address to read.
- Return :
  - `uint8_t`

### MCP23S17_write_REG :
- Description :
  Allows to write a configuration byte to a register in the MCP23S17. 
- Params :
  - `MCP23S17* mcp23s17` : Struct address pointer;
  - `uint8_t reg_addr` : Destination register address to write;
  - `uint8_t config` : Configuration byte.
- Return :
  - `void`

### MCP23S17_check_REG :
- Description :
  Allows to check if the register is valid for IOCON.BANK = 0.
- Params :
  - `uint8_t reg_addr` : Register address to check.
- Return :
  - `void`

## How to use

1. Ensure your have a SPI connectivity configured on your STM32 :
- Max speed : 10 MHz
- SPI Mode 0 :
  - CPHA : 0
  - CPOL : 0

Example SPI config generated by CubeIDE :
```c
static void MX_SPI1_Init(void)
{
  /* SPI1 parameter configuration*/
  hspi1.Instance = SPI1;
  hspi1.Init.Mode = SPI_MODE_MASTER;
  hspi1.Init.Direction = SPI_DIRECTION_2LINES;
  hspi1.Init.DataSize = SPI_DATASIZE_8BIT;
  hspi1.Init.CLKPolarity = SPI_POLARITY_LOW;
  hspi1.Init.CLKPhase = SPI_PHASE_1EDGE;
  hspi1.Init.NSS = SPI_NSS_SOFT;
  hspi1.Init.BaudRatePrescaler = SPI_BAUDRATEPRESCALER_64;
  hspi1.Init.FirstBit = SPI_FIRSTBIT_MSB;
  hspi1.Init.TIMode = SPI_TIMODE_DISABLE;
  hspi1.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;
  hspi1.Init.CRCPolynomial = 7;
  hspi1.Init.CRCLength = SPI_CRC_LENGTH_DATASIZE;
  hspi1.Init.NSSPMode = SPI_NSS_PULSE_ENABLE;
  if (HAL_SPI_Init(&hspi1) != HAL_OK)
  {
    Error_Handler();
  }
}
```

2. Include `MCP23S17.h` file in your code.

3. Instantiate struct :
```c
MCP23S17 mcp23s17;
```

4. Pass the object address pointer, hardware address, SPI pin, SPI port and the SPI handler :
```c
  MCP23S17_Init(&mcp23s17, 000, SPI1_CS1_Pin, SPI1_CS1_GPIO_Port, hspi1);
```
